'use client';

import { useState } from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { signOut } from 'next-auth/react';
import { Menu, LogOut, ChevronLeft, ChevronRight, LayoutDashboard } from 'lucide-react';

export default function MainSidebar({ isDesktopCollapsed, onDesktopToggle }) {
    const pathname = usePathname();
    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

    const navItems = [
        {
            label: 'Dashboard',
            href: '/widgets/dashboard',
            icon: <LayoutDashboard className="w-5 h-5 text-visualy-accent-4" />,
        },
        {
            label: 'Logo',
            href: '/widgets/logo-carousel',
            icon: (
                <svg
                    className="w-5 h-5 text-visualy-accent-4"
                    viewBox="0 0 53 32"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                >
                    <path d="M25.132 5.541c-1.717 0-3.122 1.405-3.122 3.122s1.405 3.122 3.122 3.122 3.122-1.405 3.122-3.122-1.405-3.122-3.122-3.122zM25.132 10.927c-1.249 0-2.341-1.015-2.341-2.341s1.015-2.341 2.341-2.341 2.341 1.015 2.341 2.341-1.093 2.341-2.341 2.341z"></path><path d="M25.054 31.22h-3.2c-0.234 0-0.39 0.156-0.39 0.39s0.156 0.39 0.39 0.39h3.2c0.234 0 0.39-0.156 0.39-0.39s-0.234-0.39-0.39-0.39z"></path><path d="M28.254 31.22h-0.546c-0.234 0-0.39 0.156-0.39 0.39s0.156 0.39 0.39 0.39h0.546c0.234 0 0.39-0.156 0.39-0.39s-0.156-0.39-0.39-0.39z"></path><path d="M31.376 31.22h-0.546c-0.234 0-0.39 0.156-0.39 0.39s0.156 0.39 0.39 0.39h0.546c0.234 0 0.39-0.156 0.39-0.39s-0.156-0.39-0.39-0.39z"></path><path d="M40.741 0h-28.254c-2.341 0-4.293 1.951-4.293 4.293v15.766c0 2.341 1.951 4.293 4.293 4.293h28.254c2.341 0 4.293-1.951 4.293-4.293v-15.766c0-2.341-1.951-4.293-4.293-4.293zM40.741 23.571h-20.995l8.663-8.351 5.307 4.449 7.024-8.663 3.434 3.824v5.229c0.078 1.951-1.483 3.512-3.434 3.512zM44.254 13.659l-3.512-3.824-7.102 8.819-5.229-4.371-9.756 9.366h-6.166c-1.951 0-3.512-1.561-3.512-3.512v-15.844c0-1.951 1.561-3.512 3.512-3.512h28.254c1.951 0 3.512 1.561 3.512 3.512v9.366z"></path><path d="M4.527 5.073h1.639c0.234 0 0.39-0.156 0.39-0.39s-0.234-0.39-0.39-0.39h-1.639c-2.498 0-4.527 2.029-4.527 4.449v6.868c0 2.498 2.029 4.449 4.527 4.449h1.639c0.234 0 0.39-0.156 0.39-0.39s-0.156-0.39-0.39-0.39h-1.639c-2.107 0-3.746-1.639-3.746-3.668v-6.79c0-2.107 1.639-3.746 3.746-3.746z"></path><path d="M48.781 4.293h-1.639c-0.234 0-0.39 0.156-0.39 0.39s0.156 0.39 0.39 0.39h1.639c2.029 0 3.746 1.639 3.746 3.746v6.79c0 2.029-1.639 3.668-3.746 3.668h-1.639c-0.234 0-0.39 0.156-0.39 0.39s0.156 0.39 0.39 0.39h1.639c2.498 0 4.527-2.029 4.527-4.449v-6.79c-0.078-2.498-2.107-4.527-4.527-4.527z"></path>
                </svg>
            ),
        },
        {
            label: 'Produkty',
            href: '/widgets/heureka',
            icon: (
                <svg
                    className="w-5 h-5 text-visualy-accent-4"
                    viewBox="0 0 32 32"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                >
                    <path d="M30.287 17.985h-8.409l-1.168-2.569c-0.156-0.389-0.311-0.779-0.389-1.168 0 0 0 0 0 0 0-0.078 0-0.156-0.078-0.156-0.078-0.467-0.156-0.856-0.156-1.324 0-0.623 0.078-1.324 0.311-1.946 0.389-1.324 0.623-2.569 0.623-3.659 0-1.713 0.078-4.049 0.701-5.217 0.156-0.234 0.156-0.545 0-0.779-0.078-0.234-0.311-0.389-0.545-0.467l-2.725-0.701-0.078 0.311c-0.779 2.414-2.881 3.971-5.372 3.971s-4.672-1.557-5.372-3.971l-0.234-0.311-2.647 0.623c-0.311 0.078-0.467 0.234-0.623 0.467-0.078 0.234-0.078 0.545 0 0.779 0.623 1.168 0.701 3.504 0.701 5.217 0 1.090 0.234 2.336 0.623 3.659 0.234 0.623 0.311 1.324 0.311 1.946 0 0.934-0.234 1.869-0.545 2.725l-3.815 8.487c0 0 0 0 0 0l-1.246 2.569c-0.234 0.545-0.234 1.168 0 1.713s0.701 0.934 1.246 1.168c3.737 1.246 7.552 1.869 11.445 1.869 0.934 0 1.869 0 2.725-0.078 0.234 0 0.389-0.234 0.389-0.389 0-0.234-0.234-0.389-0.389-0.389-0.856 0.078-1.713 0.078-2.647 0.078-3.815 0-7.63-0.623-11.212-1.869-0.389-0.156-0.623-0.389-0.779-0.701s-0.156-0.779 0-1.090l1.168-2.569c0 0 0 0 0 0l3.815-8.487c0.156-0.389 0.311-0.779 0.389-1.090h3.037l-1.168 6.073c-0.078 0.234 0.078 0.389 0.311 0.467 0 0 0.078 0 0.078 0 0.156 0 0.311-0.156 0.389-0.311l1.246-6.229h5.684l1.246 6.229c0 0.156 0.234 0.311 0.389 0.311 0 0 0.078 0 0.078 0 0.234-0.078 0.311-0.234 0.311-0.467l-1.168-6.073h2.959c0.078 0.389 0.234 0.779 0.389 1.090l1.090 2.336c-0.623 0.156-1.090 0.779-1.090 1.479v10.978c0 0.623 0.311 1.168 0.856 1.401s1.168 0.156 1.635-0.234l2.881-2.959c0.311-0.234 0.701-0.234 0.934 0l2.881 2.959c0.311 0.234 0.623 0.389 1.012 0.389 0.234 0 0.467-0.078 0.623-0.156 0.545-0.234 0.856-0.779 0.856-1.401v-11.056c0-0.779-0.623-1.479-1.479-1.479zM4.905 1.479v-0.078l2.024-0.467c0 0.078 0.078 0.156 0.078 0.311 0.078 0.156 0.156 0.311 0.234 0.467s0.156 0.234 0.234 0.311c0.078 0.234 0.234 0.389 0.311 0.545 0.078 0.078 0.156 0.156 0.234 0.234 0.156 0.156 0.311 0.311 0.389 0.467 0.078 0.078 0.156 0.156 0.234 0.156 0.156 0.311 0.311 0.545 0.467 0.078 0.078 0.156 0.078 0.156 0.156 0.234 0.156 0.389 0.234 0.623 0.389 0 0 0.078 0 0.078 0.078 0.856 0.389 1.791 0.623 2.725 0.623 1.324 0 2.569-0.389 3.659-1.090 0 0 0.078 0 0.078-0.078 0.234-0.156 0.467-0.311 0.623-0.545 0 0 0.078-0.078 0.078-0.078 0.311-0.234 0.467-0.389 0.701-0.623 0.078-0.078 0.078-0.156 0.156-0.156 0.156-0.156 0.234-0.389 0.389-0.545 0.078-0.078 0.156-0.156 0.156-0.311 0.078-0.156 0.156-0.311 0.234-0.545 0-0.078 0.078-0.156 0.156-0.234l2.102 0.467 0.078-0.389-0.078 0.467c-0.701 1.324-0.779 3.659-0.779 5.528 0 1.012-0.234 2.18-0.623 3.426-0.078 0.311-0.156 0.701-0.234 1.012h-13.002c0-0.234-0.078-0.545-0.234-0.934-0.389-1.246-0.623-2.414-0.623-3.426 0.078-1.946 0-4.282-0.701-5.606zM6.462 13.859c0.078-0.389 0.078-0.701 0.078-1.090 0-0.156 0-0.234 0-0.389h12.847c0 0.156 0 0.234 0 0.389 0 0.389 0 0.701 0.078 1.090h-13.002zM30.988 30.443c0 0.311-0.156 0.545-0.467 0.701-0.234 0.156-0.545 0.078-0.779-0.078l-2.881-3.037c-0.545-0.467-1.401-0.467-2.024 0l-2.881 2.959c-0.234 0.234-0.545 0.234-0.779 0.078-0.311-0.156-0.467-0.389-0.467-0.701v-10.9c0-0.389 0.311-0.779 0.779-0.779h8.798c0.389 0 0.779 0.311 0.779 0.779v10.978z"></path><path d="M28.574 21.489h-5.528c-0.234 0-0.389 0.156-0.389 0.389s0.156 0.389 0.389 0.389h5.528c0.234 0 0.389-0.156 0.389-0.389s-0.156-0.389-0.389-0.389z"></path><path d="M26.55 24.292h-3.504c-0.234 0-0.389 0.156-0.389 0.389s0.156 0.389 0.389 0.389h3.504c0.234 0 0.389-0.156 0.389-0.389s-0.156-0.389-0.389-0.389z"></path>
                </svg>
            ),
        },
        {
            label: 'FAQ',
            href: '/widgets/faq',
            icon: (
                <svg
                    className="w-5 h-5 text-visualy-accent-4"
                    viewBox="0 0 45 32"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                >
                    <path d="M16 0c-8.774 0-16 7.226-16 16 0 0.31 0.206 0.516 0.516 0.516s0.516-0.206 0.516-0.516c0-8.258 6.71-14.968 14.968-14.968s14.968 6.71 14.968 14.968v14.968h-14.968c-5.471 0-10.529-2.994-13.11-7.845-0.103-0.206-0.413-0.31-0.723-0.206-0.206 0.103-0.31 0.413-0.206 0.723 2.787 5.161 8.155 8.361 14.039 8.361h16v-16c0-8.774-7.226-16-16-16z"></path><path d="M43.974 10.219c-0.103-0.31-0.413-0.413-0.619-0.31-0.31 0.103-0.413 0.413-0.31 0.619 0.619 1.755 1.032 3.51 1.032 5.368 0 5.471-2.994 10.529-7.845 13.11-0.206 0.103-0.31 0.413-0.206 0.723 0.103 0.206 0.31 0.31 0.413 0.31s0.206 0 0.206-0.103c5.161-2.787 8.361-8.155 8.361-14.039 0.103-1.858-0.31-3.819-1.032-5.677z"></path><path d="M27.768 1.032c4.129-0.31 8.258 1.032 11.252 3.819 0.103 0.103 0.206 0.103 0.31 0.103s0.31-0.103 0.413-0.206c0.206-0.206 0.206-0.516 0-0.723-3.303-2.994-7.639-4.439-12.077-4.026-0.31 0-0.516 0.31-0.516 0.516 0.103 0.413 0.413 0.619 0.619 0.516z"></path><path d="M17.445 16.31c1.652-0.619 2.684-2.271 2.684-4.026 0-2.271-1.858-4.129-4.232-4.232-1.652 0-3.2 0.929-3.923 2.374-0.103 0.206 0 0.516 0.206 0.723 0.206 0.103 0.516 0 0.723-0.206 0.516-1.135 1.652-1.858 2.994-1.858 1.755 0 3.2 1.445 3.2 3.2 0 1.342-0.723 2.581-1.961 2.994-1.032 0.413-1.755 1.445-1.755 2.684v1.239c0 0.31 0.206 0.516 0.516 0.516s0.516-0.206 0.516-0.516v-1.239c-0.103-0.723 0.31-1.445 1.032-1.652z"></path><path d="M15.794 21.781c-0.31 0-0.516 0.206-0.516 0.516v1.032c0 0.31 0.206 0.516 0.516 0.516s0.516-0.206 0.516-0.516v-1.032c0-0.206-0.206-0.516-0.516-0.516z"></path>
                </svg>
            ),
        },
        {
            label: 'Články',
            href: '/widgets/article',
            icon: (
                <svg
                    className="w-5 h-5 text-visualy-accent-4"
                    viewBox="0 0 32 32"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                >
                    <path d="M28 8h-24c-0.442 0-0.8-0.358-0.8-0.8s0.358-0.8 0.8-0.8h24c0.442 0 0.8 0.358 0.8 0.8s-0.358 0.8-0.8 0.8zM21.6 12.8h-17.6c-0.442 0-0.8-0.358-0.8-0.8s0.358-0.8 0.8-0.8h17.6c0.442 0 0.8 0.358 0.8 0.8s-0.358 0.8-0.8 0.8zM28 17.6h-24c-0.442 0-0.8-0.358-0.8-0.8s0.358-0.8 0.8-0.8h24c0.442 0 0.8 0.358 0.8 0.8s-0.358 0.8-0.8 0.8zM21.6 22.4h-17.6c-0.442 0-0.8-0.358-0.8-0.8s0.358-0.8 0.8-0.8h17.6c0.442 0 0.8 0.358 0.8 0.8s-0.358 0.8-0.8 0.8zM28 27.2h-24c-0.442 0-0.8-0.358-0.8-0.8s0.358-0.8 0.8-0.8h24c0.442 0 0.8 0.358 0.8 0.8s-0.358 0.8-0.8 0.8z"></path>
                </svg>
            ),
        },
        {
            label: 'Autor',
            href: '/widgets/author',
            icon: (
                <svg
                    className="w-5 h-5 text-visualy-accent-4"
                    viewBox="0 0 32 32"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor"
                >
                    <path d="M32 6.009c0-3.093-2.516-5.609-5.609-5.609-1.631 0-3.1 0.7-4.126 1.814-2.038-0.92-4.214-1.388-6.478-1.388-8.705 0-15.787 7.082-15.787 15.787s7.082 15.787 15.787 15.787 15.787-7.082 15.787-15.787c0-2.264-0.468-4.44-1.388-6.478 1.115-1.026 1.814-2.496 1.814-4.126zM26.391 1.979c2.222 0 4.030 1.808 4.030 4.030s-1.808 4.030-4.030 4.030-4.030-1.808-4.030-4.030c0-2.222 1.808-4.030 4.030-4.030zM15.787 30.821c-7.834 0-14.208-6.374-14.208-14.208s6.374-14.208 14.208-14.208c1.942 0 3.812 0.381 5.57 1.133-0.368 0.746-0.575 1.584-0.575 2.471 0 3.093 2.516 5.609 5.609 5.609 0.886 0 1.725-0.207 2.471-0.575 0.752 1.758 1.133 3.628 1.133 5.57 0 7.834-6.374 14.208-14.208 14.208zM28.486 5.22h-1.306v-1.306c0-0.436-0.353-0.789-0.789-0.789s-0.789 0.353-0.789 0.789v1.306h-1.306c-0.436 0-0.789 0.353-0.789 0.789s0.353 0.789 0.789 0.789h1.306v1.306c0 0.436 0.353 0.789 0.789 0.789s0.789-0.353 0.789-0.789v-1.306h1.306c0.436 0 0.789-0.353 0.789-0.789s-0.353-0.789-0.789-0.789zM20.636 19.438c-0.018-0.001-1.946 0.066-2.499-1.956 0.36-0.275 0.695-0.615 0.992-1.018 0.639-0.865 1.056-1.943 1.214-3.109 0.045-0.054 0.083-0.115 0.112-0.183 0.274-0.652 0.413-1.348 0.413-2.068 0-2.774-2.101-5.031-4.683-5.031-0.663 0-1.306 0.149-1.914 0.444-0.224 0.020-0.444 0.061-0.656 0.122-2.164 0.625-3.388 3.233-2.73 5.815 0.066 0.259 0.226 0.755 0.356 0.935 0.246 1.757 1.069 3.225 2.197 4.087-0.562 2.056-2.483 1.962-2.5 1.963-1.865 0.060-3.364 1.595-3.364 3.474v2.27c0 0.853 0.694 1.546 1.546 1.546h13.333c0.853 0 1.546-0.694 1.546-1.546v-2.27c-0-1.879-1.498-3.413-3.363-3.474zM14.009 8.003c0.154-0.045 0.317-0.071 0.485-0.079 0.104-0.005 0.206-0.032 0.298-0.081 0.443-0.233 0.912-0.351 1.393-0.351 1.703 0 3.105 1.453 3.249 3.298-0.354-0.223-0.773-0.352-1.222-0.352h-3.215c-0.139 0-0.272-0.044-0.382-0.126-0.095-0.071-0.168-0.166-0.212-0.274-0.131-0.327-0.456-0.533-0.808-0.51s-0.651 0.268-0.741 0.611c-0.135 0.519-0.373 1.006-0.694 1.433-0.213-1.655 0.552-3.194 1.849-3.569zM12.642 13.152c0.501-0.468 0.913-1.024 1.211-1.638 0.339 0.227 0.732 0.346 1.143 0.346h3.215c0.34 0 0.635 0.194 0.782 0.477-0.012 1.864-0.803 3.465-1.928 4.167-0.036 0.017-0.549 0.38-1.276 0.38-1.522-0-2.861-1.615-3.147-3.733zM17.887 19.78c-0.604 0.439-1.338 0.683-2.097 0.683-0.761 0-1.495-0.244-2.1-0.685 0.469-0.444 0.83-1.003 1.036-1.633 0.342 0.104 0.699 0.159 1.064 0.159 0.362 0 0.717-0.054 1.060-0.157 0.206 0.63 0.568 1.189 1.038 1.632zM22.578 25.182v0c0 0.069-0.056 0.125-0.125 0.125h-13.333c-0.069 0-0.126-0.056-0.126-0.125v-2.27c0-1.134 0.922-2.056 2.056-2.056 0.019 0 0.69-0.011 1.379-0.274 0.913 0.833 2.111 1.302 3.36 1.302s2.445-0.469 3.358-1.301c0.703 0.286 1.356 0.273 1.375 0.273 1.134 0 2.056 0.922 2.056 2.056v2.27z" />
                </svg>
            ),
        },
    ];

    return (
        <>
            {/* Mobile toggle */}
            <button
                onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                type="button"
                className="inline-flex items-center p-2 mt-2 ms-3 text-sm rounded-lg sm:hidden text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-300 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
            >
                <span className="sr-only">Open sidebar</span>
                <Menu className="w-6 h-6" />
            </button>

            {/* Desktop Toggle Arrow */}
            <button
                onClick={onDesktopToggle}
                className={`hidden sm:flex fixed top-1/2 z-50 items-center justify-center w-4 h-10 bg-gray-900 text-gray-400 hover:text-white rounded-r-lg transition-all duration-300 transform -translate-y-1/2 ${isDesktopCollapsed ? 'left-0' : 'left-64'
                    }`}
                aria-label={isDesktopCollapsed ? "Open sidebar" : "Close sidebar"}
            >
                {isDesktopCollapsed ? <ChevronRight className="w-4 h-4" /> : <ChevronLeft className="w-4 h-4" />}
            </button>

            {/* Overlay */}
            {isMobileMenuOpen && (
                <div
                    className="fixed inset-0 z-30 bg-gray-900/50 sm:hidden backdrop-blur-sm"
                    onClick={() => setIsMobileMenuOpen(false)}
                />
            )}

            {/* Sidebar */}
            <aside
                id="logo-sidebar"
                className={`fixed top-0 left-0 z-40 w-64 h-screen transition-transform duration-300 bg-gray-900 text-white ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'
                    } ${isDesktopCollapsed ? 'sm:-translate-x-full' : 'sm:translate-x-0'
                    }`}
                aria-label="Sidebar"
            >
                <div className="flex flex-col h-full">
                    {/* Header */}
                    <div className="flex items-center gap-3 px-4 py-4 border-b border-gray-800">
                        <img
                            src="/visualy_logo.png"
                            alt="Visualy"
                            className="h-8 w-auto object-contain"
                        />
                        <span className="text-lg font-semibold">Visualy</span>
                    </div>

                    {/* Navigation */}
                    <nav className="flex-1 overflow-y-auto py-4">
                        <ul className="space-y-1 px-2">
                            {navItems.map((item) => {
                                const isActive = pathname.startsWith(item.href);
                                return (
                                    <li key={item.href}>
                                        <Link
                                            href={item.href}
                                            onClick={() => setIsMobileMenuOpen(false)}
                                            className={
                                                `flex items-center gap-3 px-3 py-2 rounded-lg transition-colors duration-200 hover:bg-gray-800 hover:text-white ` +
                                                (isActive
                                                    ? 'bg-gray-800 text-white font-medium'
                                                    : 'text-gray-300')
                                            }
                                        >
                                            <span className="text-gray-400 group-hover:text-white">
                                                {item.icon}
                                            </span>
                                            {item.label}
                                        </Link>
                                    </li>
                                );
                            })}
                        </ul>
                    </nav>

                    {/* Footer */}
                    <div className="px-2 py-4 border-t border-gray-800">
                        <button
                            onClick={() => signOut({ callbackUrl: '/prihlaseni' })}
                            aria-label="Odhlásit se z aplikace"
                            className="flex w-full items-center gap-3 px-3 py-2 rounded-lg text-gray-300 hover:bg-gray-800 hover:text-white transition-colors duration-200"
                        >
                            <LogOut className="w-5 h-5 text-visualy-accent-4 group-hover:text-white" aria-hidden="true" />
                            Odhlásit se
                        </button>
                    </div>
                </div>
            </aside>
        </>
    );
}
